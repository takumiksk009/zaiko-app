<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>在庫管理サンプル（Firebase対応）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; color: #2c3e50; }
    h1 { text-align: center; }
    .section { margin-bottom: 40px; }
    input, button, select {
      padding: 8px; margin: 4px 0; font-size: 14px; width: 100%;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #3498db; color: white; }
    .actions button { margin: 0 4px; }
    .tab { margin-bottom: 10px; }
    .tab button { padding: 10px; margin-right: 5px; }
    .hidden { display: none; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <h1>在庫管理（Firebase対応）</h1>

  <div class="tab">
    <button onclick="switchTab('register')">登録</button>
    <button onclick="switchTab('list')">一覧</button>
  </div>

  <div id="register" class="section">
    <h2>在庫登録</h2>
    <input type="text" id="user" placeholder="登録者">
    <input type="text" id="maker" placeholder="メーカー">
    <input type="text" id="category" placeholder="カテゴリ">
    <input type="text" id="model" placeholder="型式">
    <input type="number" id="qty" placeholder="個数">
    <input type="text" id="site" placeholder="現場名">
    <input type="date" id="date">
    <button onclick="addInventory()">登録</button>
  </div>

  <div id="list" class="section hidden">
    <h2>在庫一覧</h2>
    <table>
      <thead>
        <tr><th>登録者</th><th>メーカー</th><th>カテゴリ</th><th>型式</th><th>個数</th><th>現場名</th><th>注文日</th><th>操作</th></tr>
      </thead>
      <tbody id="inventoryBody"></tbody>
    </table>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyARhO9hECPxXopKRBZrHBAkboqmCxY651i0",
      authDomain: "zaiko-app-54fa6.firebaseapp.com",
      databaseURL: "https://zaiko-app-54fa6-default-rtdb.firebaseio.com",
      projectId: "zaiko-app-54fa6",
      storageBucket: "zaiko-app-54fa6.appspot.com",
      messagingSenderId: "615970420186",
      appId: "1:615970420186:web:8eab3b94d70da28f5bce3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const dbRef = db.ref("inventories");

    function switchTab(tabId) {
      document.getElementById('register').classList.add('hidden');
      document.getElementById('list').classList.add('hidden');
      document.getElementById(tabId).classList.remove('hidden');
      if (tabId === 'list') renderInventory();
    }

    function addInventory() {
      const newItem = {
        user: document.getElementById('user').value,
        maker: document.getElementById('maker').value,
        category: document.getElementById('category').value,
        model: document.getElementById('model').value,
        qty: parseInt(document.getElementById('qty').value) || 0,
        site: document.getElementById('site').value,
        date: document.getElementById('date').value,
        remaining: parseInt(document.getElementById('qty').value) || 0,
        timestamp: Date.now()
      };
      dbRef.push(newItem);
      alert("登録しました！");
      document.querySelectorAll('#register input').forEach(el => el.value = "");
    }

    function renderInventory() {
      dbRef.once("value", snapshot => {
        const tbody = document.getElementById("inventoryBody");
        tbody.innerHTML = "";
        snapshot.forEach(child => {
          const item = child.val();
          if (item.remaining > 0) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${item.user}</td>
              <td>${item.maker}</td>
              <td>${item.category}</td>
              <td>${item.model}</td>
              <td>${item.remaining}</td>
              <td>${item.site}</td>
              <td>${item.date}</td>
              <td class="actions">
                <button onclick="useItem('${child.key}', ${item.remaining})">使用</button>
                <button onclick="deleteItem('${child.key}')">削除</button>
              </td>
            `;
            tbody.appendChild(tr);
          }
        });
      });
    }

    function useItem(key, remaining) {
      if (remaining > 0) {
        dbRef.child(key).update({ remaining: remaining - 1 });
        renderInventory();
      }
    }

    function deleteItem(key) {
      dbRef.child(key).remove();
      renderInventory();
    }

    window.addEventListener("DOMContentLoaded", () => {
      renderInventory();
    });
  </script>
</body>
</html>